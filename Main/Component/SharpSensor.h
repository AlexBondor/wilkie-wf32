#ifndef SharpSensor_h
#define SharpSensor_h

#include "Arduino.h"

// 4cm from sensor led to center of the robot
#define DISTANCE_FROM_SENSOR_TO_ROBOT_CENTER 4

class SharpSensor
{
  public:
    SharpSensor();
    float getDistance();
    void attach(int pin, int avg);

  private:
    int getRaw();
    int _pin;
    int _avg;
    int _readingsCount;
    int _lastIndex;
    int _readings[50];
    void sort(int* readings);    
};

#define MIN_RAW 200
#define MAX_RAW 730

/*
 * Raw analogRead values translated to
 * cm values. Values obtained by manual
 * testing of the proximity sensor.
 */
const float RAW_TO_CM [531][2] = {
  {200, 50.3},
  {201, 49.9},
  {202, 49.5},
  {203, 49.2},
  {204, 48.8},
  {205, 48.5},
  {206, 48.1},
  {207, 47.8},
  {208, 47.4},
  {209, 47.1},
  {210, 46.8},
  {211, 46.4},
  {212, 46.1},
  {213, 45.8},
  {214, 45.5},
  {215, 45.1},
  {216, 44.8},
  {217, 44.5},
  {218, 44.2},
  {219, 43.9},
  {220, 43.6},
  {221, 43.3},
  {222, 43.0},
  {223, 42.8},
  {224, 42.5},
  {225, 42.2},
  {226, 41.9},
  {227, 41.6},
  {228, 41.4},
  {229, 41.1},
  {230, 40.8},
  {231, 40.6},
  {232, 40.3},
  {233, 40.1},
  {234, 39.8},
  {235, 39.6},
  {236, 39.3},
  {237, 39.1},
  {238, 38.8},
  {239, 38.6},
  {240, 38.4},
  {241, 38.1},
  {242, 37.9},
  {243, 37.7},
  {244, 37.4},
  {245, 37.2},
  {246, 37.0},
  {247, 36.8},
  {248, 36.6},
  {249, 36.4},
  {250, 36.1},
  {251, 35.9},
  {252, 35.7},
  {253, 35.5},
  {254, 35.3},
  {255, 35.1},
  {256, 34.9},
  {257, 34.7},
  {258, 34.5},
  {259, 34.4},
  {260, 34.2},
  {261, 34.0},
  {262, 33.8},
  {263, 33.6},
  {264, 33.4},
  {265, 33.3},
  {266, 33.1},
  {267, 32.9},
  {268, 32.7},
  {269, 32.6},
  {270, 32.4},
  {271, 32.2},
  {272, 32.1},
  {273, 31.9},
  {274, 31.7},
  {275, 31.6},
  {276, 31.4},
  {277, 31.3},
  {278, 31.1},
  {279, 30.9},
  {280, 30.8},
  {281, 30.6},
  {282, 30.5},
  {283, 30.3},
  {284, 30.2},
  {285, 30.1},
  {286, 29.9},
  {287, 29.8},
  {288, 29.6},
  {289, 29.5},
  {290, 29.3},
  {291, 29.2},
  {292, 29.1},
  {293, 28.9},
  {294, 28.8},
  {295, 28.7},
  {296, 28.5},
  {297, 28.4},
  {298, 28.3},
  {299, 28.2},
  {300, 28.0},
  {301, 27.9},
  {302, 27.8},
  {303, 27.7},
  {304, 27.6},
  {305, 27.4},
  {306, 27.3},
  {307, 27.2},
  {308, 27.1},
  {309, 27.0},
  {310, 26.9},
  {311, 26.7},
  {312, 26.6},
  {313, 26.5},
  {314, 26.4},
  {315, 26.3},
  {316, 26.2},
  {317, 26.1},
  {318, 26.0},
  {319, 25.9},
  {320, 25.8},
  {321, 25.7},
  {322, 25.6},
  {323, 25.5},
  {324, 25.4},
  {325, 25.3},
  {326, 25.2},
  {327, 25.1},
  {328, 25.0},
  {329, 24.9},
  {330, 24.8},
  {331, 24.7},
  {332, 24.6},
  {333, 24.5},
  {334, 24.4},
  {335, 24.3},
  {336, 24.2},
  {337, 24.2},
  {338, 24.1},
  {339, 24.0},
  {340, 23.9},
  {341, 23.8},
  {342, 23.7},
  {343, 23.6},
  {344, 23.6},
  {345, 23.5},
  {346, 23.4},
  {347, 23.3},
  {348, 23.2},
  {349, 23.1},
  {350, 23.1},
  {351, 23.0},
  {352, 22.9},
  {353, 22.8},
  {354, 22.7},
  {355, 22.7},
  {356, 22.6},
  {357, 22.5},
  {358, 22.4},
  {359, 22.4},
  {360, 22.3},
  {361, 22.2},
  {362, 22.2},
  {363, 22.1},
  {364, 22.0},
  {365, 21.9},
  {366, 21.9},
  {367, 21.8},
  {368, 21.7},
  {369, 21.7},
  {370, 21.6},
  {371, 21.5},
  {372, 21.5},
  {373, 21.4},
  {374, 21.3},
  {375, 21.3},
  {376, 21.2},
  {377, 21.1},
  {378, 21.1},
  {379, 21.0},
  {380, 20.9},
  {381, 20.9},
  {382, 20.8},
  {383, 20.7},
  {384, 20.7},
  {385, 20.6},
  {386, 20.6},
  {387, 20.5},
  {388, 20.4},
  {389, 20.4},
  {390, 20.3},
  {391, 20.3},
  {392, 20.2},
  {393, 20.1},
  {394, 20.1},
  {395, 20.0},
  {396, 20.0},
  {397, 19.9},
  {398, 19.9},
  {399, 19.8},
  {400, 19.7},
  {401, 19.7},
  {402, 19.6},
  {403, 19.6},
  {404, 19.5},
  {405, 19.5},
  {406, 19.4},
  {407, 19.4},
  {408, 19.3},
  {409, 19.3},
  {410, 19.2},
  {411, 19.1},
  {412, 19.1},
  {413, 19.0},
  {414, 19.0},
  {415, 18.9},
  {416, 18.9},
  {417, 18.8},
  {418, 18.8},
  {419, 18.7},
  {420, 18.7},
  {421, 18.6},
  {422, 18.6},
  {423, 18.5},
  {424, 18.5},
  {425, 18.4},
  {426, 18.4},
  {427, 18.4},
  {428, 18.3},
  {429, 18.3},
  {430, 18.2},
  {431, 18.2},
  {432, 18.1},
  {433, 18.1},
  {434, 18.0},
  {435, 18.0},
  {436, 17.9},
  {437, 17.9},
  {438, 17.8},
  {439, 17.8},
  {440, 17.8},
  {441, 17.7},
  {442, 17.7},
  {443, 17.6},
  {444, 17.6},
  {445, 17.5},
  {446, 17.5},
  {447, 17.4},
  {448, 17.4},
  {449, 17.4},
  {450, 17.3},
  {451, 17.3},
  {452, 17.2},
  {453, 17.2},
  {454, 17.2},
  {455, 17.1},
  {456, 17.1},
  {457, 17.0},
  {458, 17.0},
  {459, 17.0},
  {460, 16.9},
  {461, 16.9},
  {462, 16.8},
  {463, 16.8},
  {464, 16.8},
  {465, 16.7},
  {466, 16.7},
  {467, 16.6},
  {468, 16.6},
  {469, 16.6},
  {470, 16.5},
  {471, 16.5},
  {472, 16.4},
  {473, 16.4},
  {474, 16.4},
  {475, 16.3},
  {476, 16.3},
  {477, 16.3},
  {478, 16.2},
  {479, 16.2},
  {480, 16.1},
  {481, 16.1},
  {482, 16.1},
  {483, 16.0},
  {484, 16.0},
  {485, 16.0},
  {486, 15.9},
  {487, 15.9},
  {488, 15.8},
  {489, 15.8},
  {490, 15.8},
  {491, 15.7},
  {492, 15.7},
  {493, 15.7},
  {494, 15.6},
  {495, 15.6},
  {496, 15.6},
  {497, 15.5},
  {498, 15.5},
  {499, 15.5},
  {500, 15.4},
  {501, 15.4},
  {502, 15.4},
  {503, 15.3},
  {504, 15.3},
  {505, 15.3},
  {506, 15.2},
  {507, 15.2},
  {508, 15.2},
  {509, 15.1},
  {510, 15.1},
  {511, 15.1},
  {512, 15.0},
  {513, 15.0},
  {514, 15.0},
  {515, 14.9},
  {516, 14.9},
  {517, 14.9},
  {518, 14.8},
  {519, 14.8},
  {520, 14.8},
  {521, 14.7},
  {522, 14.7},
  {523, 14.7},
  {524, 14.6},
  {525, 14.6},
  {526, 14.6},
  {527, 14.6},
  {528, 14.5},
  {529, 14.5},
  {530, 14.5},
  {531, 14.4},
  {532, 14.4},
  {533, 14.4},
  {534, 14.3},
  {535, 14.3},
  {536, 14.3},
  {537, 14.2},
  {538, 14.2},
  {539, 14.2},
  {540, 14.2},
  {541, 14.1},
  {542, 14.1},
  {543, 14.1},
  {544, 14.0},
  {545, 14.0},
  {546, 14.0},
  {547, 14.0},
  {548, 13.9},
  {549, 13.9},
  {550, 13.9},
  {551, 13.8},
  {552, 13.8},
  {553, 13.8},
  {554, 13.7},
  {555, 13.7},
  {556, 13.7},
  {557, 13.7},
  {558, 13.6},
  {559, 13.6},
  {560, 13.6},
  {561, 13.6},
  {562, 13.5},
  {563, 13.5},
  {564, 13.5},
  {565, 13.4},
  {566, 13.4},
  {567, 13.4},
  {568, 13.4},
  {569, 13.3},
  {570, 13.3},
  {571, 13.3},
  {572, 13.2},
  {573, 13.2},
  {574, 13.2},
  {575, 13.2},
  {576, 13.1},
  {577, 13.1},
  {578, 13.1},
  {579, 13.1},
  {580, 13.0},
  {581, 13.0},
  {582, 13.0},
  {583, 13.0},
  {584, 12.9},
  {585, 12.9},
  {586, 12.9},
  {587, 12.8},
  {588, 12.8},
  {589, 12.8},
  {590, 12.8},
  {591, 12.7},
  {592, 12.7},
  {593, 12.7},
  {594, 12.7},
  {595, 12.6},
  {596, 12.6},
  {597, 12.6},
  {598, 12.6},
  {599, 12.5},
  {600, 12.5},
  {601, 12.5},
  {602, 12.5},
  {603, 12.4},
  {604, 12.4},
  {605, 12.4},
  {606, 12.4},
  {607, 12.3},
  {608, 12.3},
  {609, 12.3},
  {610, 12.3},
  {611, 12.2},
  {612, 12.2},
  {613, 12.2},
  {614, 12.2},
  {615, 12.1},
  {616, 12.1},
  {617, 12.1},
  {618, 12.1},
  {619, 12.1},
  {620, 12.0},
  {621, 12.0},
  {622, 12.0},
  {623, 12.0},
  {624, 11.9},
  {625, 11.9},
  {626, 11.9},
  {627, 11.9},
  {628, 11.8},
  {629, 11.8},
  {630, 11.8},
  {631, 11.8},
  {632, 11.7},
  {633, 11.7},
  {634, 11.7},
  {635, 11.7},
  {636, 11.7},
  {637, 11.6},
  {638, 11.6},
  {639, 11.6},
  {640, 11.6},
  {641, 11.5},
  {642, 11.5},
  {643, 11.5},
  {644, 11.5},
  {645, 11.4},
  {646, 11.4},
  {647, 11.4},
  {648, 11.4},
  {649, 11.4},
  {650, 11.3},
  {651, 11.3},
  {652, 11.3},
  {653, 11.3},
  {654, 11.2},
  {655, 11.2},
  {656, 11.2},
  {657, 11.2},
  {658, 11.2},
  {659, 11.1},
  {660, 11.1},
  {661, 11.1},
  {662, 11.1},
  {663, 11.0},
  {664, 11.0},
  {665, 11.0},
  {666, 11.0},
  {667, 11.0},
  {668, 10.9},
  {669, 10.9},
  {670, 10.9},
  {671, 10.9},
  {672, 10.9},
  {673, 10.8},
  {674, 10.8},
  {675, 10.8},
  {676, 10.8},
  {677, 10.7},
  {678, 10.7},
  {679, 10.7},
  {680, 10.7},
  {681, 10.7},
  {682, 10.6},
  {683, 10.6},
  {684, 10.6},
  {685, 10.6},
  {686, 10.6},
  {687, 10.5},
  {688, 10.5},
  {689, 10.5},
  {690, 10.5},
  {691, 10.5},
  {692, 10.4},
  {693, 10.4},
  {694, 10.4},
  {695, 10.4},
  {696, 10.4},
  {697, 10.3},
  {698, 10.3},
  {699, 10.3},
  {700, 10.3},
  {701, 10.3},
  {702, 10.2},
  {703, 10.2},
  {704, 10.2},
  {705, 10.2},
  {706, 10.2},
  {707, 10.1},
  {708, 10.1},
  {709, 10.1},
  {710, 10.1},
  {711, 10.1},
  {712, 10.0},
  {713, 10.0},
  {714, 10.0},
  {715, 10.0},
  {716, 10.0},
  {717, 9.9},
  {718, 9.9},
  {719, 9.9},
  {720, 9.9},
  {721, 9.9},
  {722, 9.8},
  {723, 9.8},
  {724, 9.8},
  {725, 9.8},
  {726, 9.8},
  {727, 9.8},
  {728, 9.7},
  {729, 9.7},
  {730, 9.7}
};

#endif
